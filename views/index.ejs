<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>PicParadise - Home</title>
    <link rel="stylesheet" href="./css/bootstrap.min.css">
    <link rel="stylesheet" href="./css/style.css">
    <script src="./js/jquery-2.1.4.min.js"></script>
    <script src="./socket.io/socket.io.js"></script>
    <script src="./js/photogrid_utils.js"></script>
    <script>
    $(function () {
        var host = <%- JSON.stringify(host) %>;

        console.log(host);

        $(document).on('click', '#doUpload', function () {
            upLoadNow();
        })

        var socket = io(host);

        socket.on('status', function (data) {
            showStatus(data.msg, data.delay);
        });

        socket.on('doUpdate', function () {
            renderList();
        });

        function upLoadNow () {
            $('.progress').fadeIn(100);
            var uploadURL = host + '/upload';
            var uploadFile = $('.uploadPic');

            if(uploadFile.val() != '') {
                var form = new FormData();
                form.append("upload", uploadFile[0].files[0]);

                // Perform the AJAX POST requrest and send the file
                ajax({
                    method: 'post',
                    url: uploadURL,
                    success: function () {
                        $('.progress').fadeOut(200);
                        uploadFile.val('');
                    },
                    progress: function (event) {
                        if(event.lengthComputable) {
                            var perc = Math.round((event.loaded * 100) / event.total);
                            $('.progress').css('width', (perc + '%'))
                        }
                    },
                    payload: form
                })
            }
        }
    })
    </script>
</head>
<body>
    <div>
        <div>
            <h1>PicParadise - Home</h1>
        </div>
        <p class="userName"><%= user.username %></p>
        <a href="/logout" id="logOutBtn">Logout</a>

        <div class="controls">
            <input type="file" name="uploadPic" class="uploadPic">
            <button id="doUpload">Upload</button>
            <div class="progressBarDiv">
                <div class="progress"></div>
            </div>
            <h5 class="status"></h5>
        </div>

        <div class="gallery">
            <ul>
                <!-- Repeat the following <li> structure for every image -->
                <!-- <li>
                    <div class="overlay">
                    <div class="voteCtrl">
                        <a href="#" class="voteUp">
                            <img src="../images/voteup.png" alt="Click Here to Vote Up !">
                            <h4>100</h4>
                        </a>
                    </div>
                    </div>
                    <div class="imageHolder">
                        <img src="../images/someimage.jpg" alt="">
                    </div>
                </li> -->
                <!-- End Repeat -->
            </ul>
        </div>
    </div>
</body>
</html>